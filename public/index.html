<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Donación</title>
  </head>
  <body>
    <h1>Donación</h1>
    <h2>Total S/. <span id="total">0.00</span></h2>

    <ul id="lista"></ul>

    <p>
      <input type="text" id="inputNombre" placeholder="Nombre" />
      <input type="text" id="inputDNI" placeholder="DNI" />
      <input type="number" id="inputMonto" placeholder="Monto" />
      <button onclick="enviar()">Enviar donación</button>
    </p>

    <script src="/socket.io/socket.io.js"></script>
    <script>
      const socket = io();
      const inputNombre = document.getElementById("inputNombre");
      const inputDNI = document.getElementById("inputDNI");
      const inputMonto = document.getElementById("inputMonto");

      const limpiar = () => {
        inputNombre.value = "";
        inputDNI.value = "";
        inputMonto.value = "";
      };

      const enviar = () => {
        console.log("Enviando donacion...");
        const datos = {
          nombre: inputNombre.value,
          dni: inputDNI.value,
          monto: inputMonto.value,
        };
        socket.emit("enviar-donacion", datos);
        limpiar();
      };

      const list = document.getElementById("lista");
      const total = document.getElementById("total");

      socket.on("historico", (datos) => {
        console.log(datos);
        for (donante of datos.donantes) {
          lista.innerHTML += `<li>${donante}</li>`;
        }
      });

      socket.on("respuesta", (datos) => {
        console.log(datos);
        list.innerHTML += `<li>${datos.persona}</li>`;
        total.setValue = datos.total;
      });
    </script>
  </body>
</html>
